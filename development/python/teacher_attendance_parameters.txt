{"teacher_attendance_jolt_block":"""[{
    "operation": "shift",
    "spec": {
      "*": {
        "x_axis": "data.[&1].x_axis",
        "district_name": "data.[&1].district_name",
        "district_id": "data.[&1].district_id",
        "block_name": "data.[&1].block_name",
        "x_value": "data.[&1].x_value",
        "y_axis": "data.[&1].y_axis",
        "y_value": "data.[&1].y_value",
        "z_axis": "data.[&1].z_axis",
        "z_value": "data.[&1].z_value",
        "data_from_date": "data.[&1].data_from_date",
        "data_upto_date": "data.[&1].data_upto_date",
        "year": "data.[&1].year",
        "month": "data.[&1].month",
        "@teachers_count": "data.[&1].teachers_count",
        "@total_schools": "data.[&1].total_schools",
        "teachers_count": "footer.@(1,district_id).teachers[]",
        "total_schools": "footer.@(1,district_id).schools[]"
      }
    }
},

  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "footer": {
        "*": {
          "teachers": "=intSum(@(1,teachers))",
          "schools": "=intSum(@(1,schools))"
        }
      }
    }
  },
  {
    "operation": "shift",
    "spec": {
      "data": {
        "*": {
          "x_axis": "data.[&1].x_axis",
          "district_name": "data.[&1].district_name",
          "district_id": "data.[&1].district_id",
          "block_name": "data.[&1].block_name",
          "x_value": "data.[&1].x_value",
          "y_axis": "data.[&1].y_axis",
          "y_value": "data.[&1].y_value",
          "z_axis": "data.[&1].z_axis",
          "z_value": "data.[&1].z_value",
          "data_from_date": "data.[&1].data_from_date",
          "data_upto_date": "data.[&1].data_upto_date",
          "year": "data.[&1].year",
          "month": "data.[&1].month",
          "@teachers_count": "data.[&1].teachers_count",
          "@total_schools": "data.[&1].total_schools",
          "teachers_count": "allBlocksFooter.teachers[]",
          "total_schools": "allBlocksFooter.schools[]"
        }
      },
      "footer": "&"
    }
  },
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "*": {
        "teachers": "=intSum(@(1,teachers))",
        "schools": "=intSum(@(1,schools))"
      }
    }
  }
]""",
"teacher_attendance_update_null_count":"""update log_summary
SET teacher_id = tch_att_null_col.count_null_teacherid,
school_id = tch_att_null_col.count_null_schoolid,
year = tch_att_null_col.count_null_academicyear,
month = tch_att_null_col.count_null_month
from tch_att_null_col
where tch_att_null_col.ff_uuid = log_summary.ff_uuid	""",
"teacher_attendance_select_columns":"""select TCHCD as "teacher_id",SCHCD as "school_id",AC_YEAR as "year","Month",
case when "1"  = 'NULL' then '0' else "1" end  as "day_1",
case when "2"  = 'NULL' then '0' else "2" end  as "day_2",
case when "3"  = 'NULL' then '0' else "3" end  as "day_3",
case when "4"  = 'NULL' then '0' else "4" end  as "day_4",
case when "5"  = 'NULL' then '0' else "5" end  as "day_5",
case when "6"  = 'NULL' then '0' else "6" end  as "day_6",
case when "7"  = 'NULL' then '0' else "7" end  as "day_7",
case when "8"  = 'NULL' then '0' else "8" end  as "day_8",
case when "9"  = 'NULL' then '0' else "9" end  as "day_9",
case when "10"  = 'NULL' then '0' else "10" end  as "day_10",
case when "11"  = 'NULL' then '0' else "11" end  as "day_11",
case when "12"  = 'NULL' then '0' else "12" end  as "day_12",
case when "13"  = 'NULL' then '0' else "13" end  as "day_13",
case when "14"  = 'NULL' then '0' else "14" end  as "day_14",
case when "15"  = 'NULL' then '0' else "15" end  as "day_15",
case when "16"  = 'NULL' then '0' else "16" end  as "day_16",
case when "17"  = 'NULL' then '0' else "17" end  as "day_17",
case when "18"  = 'NULL' then '0' else "18" end  as "day_18",
case when "19"  = 'NULL' then '0' else "19" end  as "day_19",
case when "20"  = 'NULL' then '0' else "20" end  as "day_20",
case when "21"  = 'NULL' then '0' else "21" end  as "day_21",
case when "22"  = 'NULL' then '0' else "22" end  as "day_22",
case when "23"  = 'NULL' then '0' else "23" end  as "day_23",
case when "24"  = 'NULL' then '0' else "24" end  as "day_24",
case when "25"  = 'NULL' then '0' else "25" end  as "day_25",
case when "26"  = 'NULL' then '0' else "26" end  as "day_26",
case when "27"  = 'NULL' then '0' else "27" end  as "day_27",
case when "28"  = 'NULL' then '0' else "28" end  as "day_28",
case when "29"  = 'NULL' then '0' else "29" end  as "day_29",
case when "30"  = 'NULL' then '0' else "30" end  as "day_30",
case when "31"  = 'NULL' then '0' else "31" end  as "day_31"
from flowfile""",
"teacher_attendance_jolt_district":"""[{
    "operation": "shift",
    "spec": {
      "*": {
        "x_axis": "data.[&1].x_axis",
        "district_name": "data.[&1].district_name",
        "x_value": "data.[&1].x_value",
        "y_axis": "data.[&1].y_axis",
        "y_value": "data.[&1].y_value",
        "z_axis": "data.[&1].z_axis",
        "z_value": "data.[&1].z_value",
        "data_from_date": "data.[&1].data_from_date",
        "data_upto_date": "data.[&1].data_upto_date",
        "year": "data.[&1].year",
        "month": "data.[&1].month",
        "@teachers_count": "data.[&1].teachers_count",
        "@total_schools": "data.[&1].total_schools",
        "teachers_count": "allDistrictsFooter.teachers[]",
        "total_schools": "allDistrictsFooter.schools[]"
      }
    }
},
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "*": {
        "teachers": "=intSum(@(1,teachers))",
        "schools": "=intSum(@(1,schools))"
      }
    }
  }
]""",
"teacher_attendance_jolt_school":"""[
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "*": {
        "cluster_id": ["=toString", null]
      }
    }
	},
  {
    "operation": "shift",
    "spec": {
      "*": {
        "x_axis": "data.[&1].x_axis",
        "school_name": "data.[&1].school_name",
        "cluster_id": "data.[&1].cluster_id",
        "cluster_name": "data.[&1].cluster_name",
        "crc_name": "data.[&1].crc_name",
        "district_id": "data.[&1].district_id",
        "district_name": "data.[&1].district_name",
        "block_id": "data.[&1].block_id",
        "block_name": "data.[&1].block_name",
        "x_value": "data.[&1].x_value",
        "y_axis": "data.[&1].y_axis",
        "y_value": "data.[&1].y_value",
        "z_axis": "data.[&1].z_axis",
        "z_value": "data.[&1].z_value",
        "data_from_date": "data.[&1].data_from_date",
        "data_upto_date": "data.[&1].data_upto_date",
        "year": "data.[&1].year",
        "month": "data.[&1].month",
        "@teachers_count": "data.[&1].teachers_count",
        "@total_schools": "data.[&1].total_schools",
        "teachers_count": "footer.@(1,cluster_id).teachers[]",
        "total_schools": "footer.@(1,cluster_id).schools[]"
      }
    }
	},

  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "footer": {
        "*": {
          "teachers": "=intSum(@(1,teachers))",
          "schools": "=intSum(@(1,schools))"
        }
      }
    }
	}
 , {
    "operation": "shift",
    "spec": {
      "data": {
        "*": {
          "x_axis": "data.[&1].x_axis",
          "school_name": "data.[&1].school_name",
          "cluster_id": "data.[&1].cluster_id",
          "cluster_name": "data.[&1].cluster_name",
          "crc_name": "data.[&1].crc_name",
          "district_id": "data.[&1].district_id",
          "district_name": "data.[&1].district_name",
          "block_id": "data.[&1].block_id",
          "block_name": "data.[&1].block_name",
          "x_value": "data.[&1].x_value",
          "y_axis": "data.[&1].y_axis",
          "y_value": "data.[&1].y_value",
          "z_axis": "data.[&1].z_axis",
          "z_value": "data.[&1].z_value",
          "data_from_date": "data.[&1].data_from_date",
          "data_upto_date": "data.[&1].data_upto_date",
          "year": "data.[&1].year",
          "month": "data.[&1].month",
          "@teachers_count": "data.[&1].teachers_count",
          "@total_schools": "data.[&1].total_schools",
          "teachers_count": "allSchoolsFooter.teachers[]",
          "total_schools": "allSchoolsFooter.schools[]"
        }
      },
      "footer": "&"
    }
	}, {
    "operation": "modify-overwrite-beta",
    "spec": {
      "*": {
        "teachers": "=intSum(@(1,teachers))",
        "schools": "=intSum(@(1,schools))"
      }
    }
	}
]""",
"tch_att_queries_filename":"""teacher_attendance_queries.json""",
"teacher_attendance_filter_same_record":"""insert into teacher_attendance_staging_2(teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,
day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid)
select teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,
day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid
from (SELECT teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,
day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid,
row_number() over (partition by teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,
day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid) 
as rn from teacher_attendance_staging_1) sq Where rn =1""",
"teacher_attendance_check_same_record":"""SELECT teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31
,ff_uuid,count(*)-1  num_of_times
FROM teacher_attendance_staging_1
GROUP BY teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid
HAVING  COUNT(*) > 1""",
"teacher_attendance_check_null":"""select * from teacher_attendance_staging_1
where teacher_id is null or
school_id is null or
year is null or
month is null""",
"teacher_attendance_update_processed_record":"""update log_summary as b
	set processed_records= a.processed_records
	from (
		select ff_uuid,count(*)as processed_records 
		from teacher_attendance_temp group by ff_uuid) as a
	where a.ff_uuid=b.ff_uuid""",
"teacher_attendance_delete_null":"""delete from teacher_attendance_staging_1 
where teacher_id is null or
school_id is null or
year is null or
month is null""",
"teacher_attendance_check_same_id_records":"""SELECT b.teacher_id,b.school_id,b.year,
b.month,b.day_1,b.day_2,b.day_3,b.day_4,b.day_5,b.day_6,b.day_7,b.day_8,b.day_9,b.day_10,b.day_11,b.day_12,b.day_13,b.day_14,b.day_15,b.day_16,b.day_17,b.day_18,b.day_19,b.day_20,b.day_21,b.day_22,b.day_23,b.day_24,b.day_25,b.day_26,b.day_27,b.day_28,b.day_29,b.day_30,b.day_31,b.ff_uuid
,count(*) num_of_times  from (select teacher_id,school_id,year,month,ff_uuid from teacher_attendance_staging_2
    group by teacher_id,school_id,year,month,ff_uuid having count(1)>1)  as a, teacher_attendance_staging_2 b
where 
a.teacher_id=b.teacher_id
and a.school_id=b.school_id
and a.year=b.year
and a.month=b.month
and a.ff_uuid=b.ff_uuid
group by b.teacher_id,b.school_id,b.year,
b.month,b.day_1,b.day_2,b.day_3,b.day_4,b.day_5,b.day_6,b.day_7,b.day_8,b.day_9,b.day_10,b.day_11,b.day_12,b.day_13,b.day_14,b.day_15,b.day_16,b.day_17,b.day_18,b.day_19,b.day_20,b.day_21,b.day_22,b.day_23,b.day_24,b.day_25,b.day_26,b.day_27,b.day_28,b.day_29,b.day_30,b.day_31,b.ff_uuid""",
"s3_output_bucket":"""cqube-gj-output""",
"teacher_attendance_count_null":"""(select 
SUM(CASE when teacher_id IS NULL THEN 1 ELSE 0 END) AS count_null_teacherid,
SUM(CASE when school_id IS NULL THEN 1 ELSE 0 END) AS count_null_schoolid,
SUM(CASE when year IS NULL THEN 1 ELSE 0 END) AS count_null_AcademicYear,
SUM(CASE when month IS NULL THEN 1 ELSE 0 END) AS count_null_Month
from teacher_attendance_staging_1)""",
"teacher_attendance_datatype_validation":"""Optional(parseLong()),Optional(parseLong()),Optional(StrNotNullOrEmpty()),Optional(parseLong()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),Optional(parseInt()),
Optional(parseInt()),Optional(parseInt()),Optional(parseInt())""",
"teacher_attendance_filter_same_id_records":"""insert into teacher_attendance_temp(teacher_id,school_id,year,month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,
day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid)
select teacher_id,school_id,year,month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,
day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid
from
(select teacher_id,school_id,year,month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,
day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid
,count(*) over (partition by teacher_id,school_id,year,month,ff_uuid) as rn  from teacher_attendance_staging_2)as a
where a.rn=1""",
"teacher_attendance_null_table_name":"""tch_att_null_col""",
"teacher_attendance_jolt_cluster":"""[{
    "operation": "shift",
    "spec": {
      "*": {
        "x_axis": "data.[&1].x_axis",
        "cluster_name": "data.[&1].cluster_name",
        "district_id": "data.[&1].district_id",
        "district_name": "data.[&1].district_name",
        "block_id": "data.[&1].block_id",
        "block_name": "data.[&1].block_name",
        "x_value": "data.[&1].x_value",
        "y_axis": "data.[&1].y_axis",
        "y_value": "data.[&1].y_value",
        "z_axis": "data.[&1].z_axis",
        "z_value": "data.[&1].z_value",
        "data_from_date": "data.[&1].data_from_date",
        "data_upto_date": "data.[&1].data_upto_date",
        "year": "data.[&1].year",
        "month": "data.[&1].month",
        "@teachers_count": "data.[&1].teachers_count",
        "@total_schools": "data.[&1].total_schools",
        "teachers_count": "footer.@(1,block_id).teachers[]",
        "total_schools": "footer.@(1,block_id).schools[]"
      }
    }
},

  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "footer": {
        "*": {
          "teachers": "=intSum(@(1,teachers))",
          "schools": "=intSum(@(1,schools))"
        }
      }
    }
  },
  {
    "operation": "shift",
    "spec": {
      "data": {
        "*": {
          "x_axis": "data.[&1].x_axis",
          "cluster_name": "data.[&1].cluster_name",
          "district_id": "data.[&1].district_id",
          "district_name": "data.[&1].district_name",
          "block_id": "data.[&1].block_id",
          "block_name": "data.[&1].block_name",
          "x_value": "data.[&1].x_value",
          "y_axis": "data.[&1].y_axis",
          "y_value": "data.[&1].y_value",
          "z_axis": "data.[&1].z_axis",
          "z_value": "data.[&1].z_value",
          "data_from_date": "data.[&1].data_from_date",
          "data_upto_date": "data.[&1].data_upto_date",
          "year": "data.[&1].year",
          "month": "data.[&1].month",
          "@teachers_count": "data.[&1].teachers_count",
          "@total_schools": "data.[&1].total_schools",
          "teachers_count": "allClustersFooter.teachers[]",
          "total_schools": "allClustersFooter.schools[]"
        }
      },
      "footer": "&"
    }
  },
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "*": {
        "teachers": "=intSum(@(1,teachers))",
        "schools": "=intSum(@(1,schools))"
      }
    }
  }
]""",
"teacher_attendance_stg_to_tmp":"""insert into teacher_attendance_temp(teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,
day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid)
select teacher_id,school_id,year,
month,day_1,day_2,day_3,day_4,day_5,day_6,day_7,day_8,day_9,
day_10,day_11,day_12,day_13,day_14,day_15,day_16,day_17,day_18,day_19,day_20,day_21,day_22,day_23,day_24,day_25,day_26,day_27,day_28,day_29,day_30,day_31,ff_uuid
from  teacher_attendance_staging_2""",
"teacher_attendance_trans_to_agg":"""create or replace view teacher_attendance_trans_to_aggregate as 
	select ll.year,ll.month,ll.school_id,hr.school_name,
ll.school_latitude,ll.school_longitude,ll.district_id,hr.district_name,ll.district_latitude,
ll.district_longitude,ll.block_id,hr.block_name,'NA' as brc_name,ll.block_latitude,ll.block_longitude,ll.cluster_id,
hr.cluster_name,hr.crc_name,ll.cluster_latitude,ll.cluster_longitude,
cast(ll.present_sum as int) as total_present,cast(ll.working_days as int) as total_working_days,ll.teachers_count
from (select at.present_sum,at.working_days,at.month,at.year,at.teachers_count,at.school_id,
sg.school_latitude,sg.school_longitude,sg.district_id,sg.district_latitude,sg.district_longitude,sg.block_id,
sg.block_latitude,sg.block_longitude,
sg.cluster_id,sg.cluster_latitude,sg.cluster_longitude
 from (select
sum(cast((
case when day_1=1 then 1 when day_1=6 then 1 when day_1=7 then 1 when day_1=3 then 0.5 else 0 end +
case when day_2=1 then 1 when day_2=6 then 1 when day_2=7 then 1 when day_2=3 then 0.5 else 0 end +
case when day_3=1 then 1 when day_3=6 then 1 when day_3=7 then 1 when day_3=3 then 0.5 else 0 end +
case when day_4=1 then 1 when day_4=6 then 1 when day_4=7 then 1 when day_4=3 then 0.5 else 0 end +
case when day_5=1 then 1 when day_5=6 then 1 when day_5=7 then 1 when day_5=3 then 0.5 else 0 end +
case when day_6=1 then 1 when day_6=6 then 1 when day_6=7 then 1 when day_6=3 then 0.5 else 0 end +
case when day_7=1 then 1 when day_7=6 then 1 when day_7=7 then 1 when day_7=3 then 0.5 else 0 end +
case when day_8=1 then 1 when day_8=6 then 1 when day_8=7 then 1 when day_8=3 then 0.5 else 0 end +
case when day_9=1 then 1 when day_9=6 then 1 when day_9=7 then 1 when day_9=3 then 0.5 else 0 end +
case when day_10=1 then 1 when day_10=6 then 1 when day_10=7 then 1 when day_10=3 then 0.5 else 0 end +
case when day_11=1 then 1 when day_11=6 then 1 when day_11=7 then 1 when day_11=3 then 0.5 else 0 end +
case when day_12=1 then 1 when day_12=6 then 1 when day_12=7 then 1 when day_12=3 then 0.5 else 0 end +
case when day_13=1 then 1 when day_13=6 then 1 when day_13=7 then 1 when day_13=3 then 0.5 else 0 end +
case when day_14=1 then 1 when day_14=6 then 1 when day_14=7 then 1 when day_14=3 then 0.5 else 0 end +
case when day_15=1 then 1 when day_15=6 then 1 when day_15=7 then 1 when day_15=3 then 0.5 else 0 end +
case when day_16=1 then 1 when day_16=6 then 1 when day_16=7 then 1 when day_16=3 then 0.5 else 0 end +
case when day_17=1 then 1 when day_17=6 then 1 when day_17=7 then 1 when day_17=3 then 0.5 else 0 end +
case when day_18=1 then 1 when day_18=6 then 1 when day_18=7 then 1 when day_18=3 then 0.5 else 0 end +
case when day_19=1 then 1 when day_19=6 then 1 when day_19=7 then 1 when day_19=3 then 0.5 else 0 end +
case when day_20=1 then 1 when day_20=6 then 1 when day_20=7 then 1 when day_20=3 then 0.5 else 0 end +
case when day_21=1 then 1 when day_21=6 then 1 when day_21=7 then 1 when day_21=3 then 0.5 else 0 end +
case when day_22=1 then 1 when day_22=6 then 1 when day_22=7 then 1 when day_22=3 then 0.5 else 0 end +
case when day_23=1 then 1 when day_23=6 then 1 when day_23=7 then 1 when day_23=3 then 0.5 else 0 end +
case when day_24=1 then 1 when day_24=6 then 1 when day_24=7 then 1 when day_24=3 then 0.5 else 0 end +
case when day_25=1 then 1 when day_25=6 then 1 when day_25=7 then 1 when day_25=3 then 0.5 else 0 end +
case when day_26=1 then 1 when day_26=6 then 1 when day_26=7 then 1 when day_26=3 then 0.5 else 0 end +
case when day_27=1 then 1 when day_27=6 then 1 when day_27=7 then 1 when day_27=3 then 0.5 else 0 end +
case when day_28=1 then 1 when day_28=6 then 1 when day_28=7 then 1 when day_28=3 then 0.5 else 0 end +
case when day_29=1 then 1 when day_29=6 then 1 when day_29=7 then 1 when day_29=3 then 0.5 else 0 end +
case when day_30=1 then 1 when day_30=6 then 1 when day_30=7 then 1 when day_30=3 then 0.5 else 0 end +
case when day_31=1 then 1 when day_31=6 then 1 when day_31=7 then 1 when day_31=3 then 0.5 else 0 end ) as float)) as present_sum,
sum(cast((case when day_1=2 or day_1=1 or day_1=3 or day_1=4 or day_1=6 or day_1=7 then 1 else 0 end +
case when day_2=2 or day_2=1 or day_2=3 or day_2=4 or day_2=6 or day_2=7 then 1 else 0 end +
case when day_3=2 or day_3=1 or day_3=3 or day_3=4 or day_3=6 or day_3=7 then 1 else 0 end +
case when day_4=2 or day_4=1 or day_4=3 or day_4=4 or day_4=6 or day_4=7 then 1 else 0 end +
case when day_5=2 or day_5=1 or day_5=3 or day_5=4 or day_5=6 or day_5=7 then 1 else 0 end +
case when day_6=2 or day_6=1 or day_6=3 or day_6=4 or day_6=6 or day_6=7 then 1 else 0 end +
case when day_7=2 or day_7=1 or day_7=3 or day_7=4 or day_7=6 or day_7=7 then 1 else 0 end +
case when day_8=2 or day_8=1 or day_8=3 or day_8=4 or day_8=6 or day_8=7 then 1 else 0 end +
case when day_9=2 or day_9=1 or day_9=3 or day_9=4 or day_9=6 or day_9=7 then 1 else 0 end +
case when day_10=2 or day_10=1 or day_10=3 or day_10=4 or day_10=6 or day_10=7 then 1 else 0 end +
case when day_11=2 or day_11=1 or day_11=3 or day_11=4 or day_11=6 or day_11=7 then 1 else 0 end +
case when day_12=2 or day_12=1 or day_12=3 or day_12=4 or day_12=6 or day_12=7 then 1 else 0 end +
case when day_13=2 or day_13=1 or day_13=3 or day_13=4 or day_13=6 or day_13=7 then 1 else 0 end +
case when day_14=2 or day_14=1 or day_14=3 or day_14=4 or day_14=6 or day_14=7 then 1 else 0 end +
case when day_15=2 or day_15=1 or day_15=3 or day_15=4 or day_15=6 or day_15=7 then 1 else 0 end +
case when day_16=2 or day_16=1 or day_16=3 or day_16=4 or day_16=6 or day_16=7 then 1 else 0 end +
case when day_17=2 or day_17=1 or day_17=3 or day_17=4 or day_17=6 or day_17=7 then 1 else 0 end +
case when day_18=2 or day_18=1 or day_18=3 or day_18=4 or day_18=6 or day_18=7 then 1 else 0 end +
case when day_19=2 or day_19=1 or day_19=3 or day_19=4 or day_19=6 or day_19=7 then 1 else 0 end +
case when day_20=2 or day_20=1 or day_20=3 or day_20=4 or day_20=6 or day_20=7 then 1 else 0 end +
case when day_21=2 or day_21=1 or day_21=3 or day_21=4 or day_21=6 or day_21=7 then 1 else 0 end +
case when day_22=2 or day_22=1 or day_22=3 or day_22=4 or day_22=6 or day_22=7 then 1 else 0 end +
case when day_23=2 or day_23=1 or day_23=3 or day_23=4 or day_23=6 or day_23=7 then 1 else 0 end +
case when day_24=2 or day_24=1 or day_24=3 or day_24=4 or day_24=6 or day_24=7 then 1 else 0 end +
case when day_25=2 or day_25=1 or day_25=3 or day_25=4 or day_25=6 or day_25=7 then 1 else 0 end +
case when day_26=2 or day_26=1 or day_26=3 or day_26=4 or day_26=6 or day_26=7 then 1 else 0 end +
case when day_27=2 or day_27=1 or day_27=3 or day_27=4 or day_27=6 or day_27=7 then 1 else 0 end +
case when day_28=2 or day_28=1 or day_28=3 or day_28=4 or day_28=6 or day_28=7 then 1 else 0 end +
case when day_29=2 or day_29=1 or day_29=3 or day_29=4 or day_29=6 or day_29=7 then 1 else 0 end +
case when day_30=2 or day_30=1 or day_30=3 or day_30=4 or day_30=6 or day_30=7 then 1 else 0 end +
case when day_31=2 or day_31=1 or day_31=3 or day_31=4 or day_31=6 or day_31=7 then 1 else 0 end )as float)) as working_days
,school_id,month,year,count(distinct(teacher_id)) as teachers_count
from teacher_attendance_trans group by school_id,year,month) as at left join school_geo_master as sg 
 on at.school_id=sg.school_id) as ll left join
school_hierarchy_details as hr on ll.school_id=hr.school_id;

insert into school_teacher_total_attendance as a (year,month,school_id,school_name,school_latitude,school_longitude,district_id,district_name,district_latitude,district_longitude,
block_id,block_name,brc_name,block_latitude,block_longitude,cluster_id,cluster_name,crc_name,cluster_latitude,cluster_longitude,total_present,total_working_days,
teachers_count)
select year,month,school_id,school_name,school_latitude,school_longitude,district_id,district_name,district_latitude,district_longitude,
block_id,block_name,brc_name,block_latitude,block_longitude,cluster_id,cluster_name,crc_name,cluster_latitude,cluster_longitude,total_present,total_working_days,
teachers_count from teacher_attendance_trans_to_aggregate
on conflict (month,year,school_id)
do update set year= a.year,month=a.month,school_id=a.school_id,school_name=a.school_name,
school_latitude=a.school_latitude,school_longitude=a.school_longitude,district_id=a.district_id,
district_name=a.district_name,district_latitude=a.district_latitude,district_longitude=a.district_longitude,
block_id=a.block_id,block_name=a.block_name,brc_name=a.brc_name,block_latitude=a.block_latitude,
block_longitude=a.block_longitude,cluster_id=a.cluster_id,cluster_name=a.cluster_name,crc_name=a.crc_name,
cluster_latitude=a.cluster_latitude,cluster_longitude=a.cluster_longitude,total_present=a.total_present,total_working_days=a.total_working_days,
teachers_count=a.teachers_count;""",
}
